# MultiZlogin

Há»‡ thá»‘ng quáº£n lÃ½ Ä‘a tÃ i khoáº£n Zalo, há»— trá»£ Ä‘Äƒng nháº­p vÃ  quáº£n lÃ½ nhiá»u tÃ i khoáº£n Zalo cÃ¹ng lÃºc, tÃ­ch há»£p proxy vÃ  webhook vá»›i tÃ­nh nÄƒng auto-reconnection vÃ  persistent storage.

## TÃ­nh nÄƒng

- âœ… ÄÄƒng nháº­p nhiá»u tÃ i khoáº£n Zalo thÃ´ng qua mÃ£ QR
- âœ… Há»— trá»£ Ä‘Äƒng nháº­p qua proxy vá»›i load balancing
- âœ… Quáº£n lÃ½ danh sÃ¡ch proxy tá»± Ä‘á»™ng
- âœ… Cáº¥u hÃ¬nh webhook riÃªng cho tá»«ng loáº¡i sá»± kiá»‡n
- âœ… GiÃ¡m sÃ¡t tráº¡ng thÃ¡i káº¿t ná»‘i cá»§a cÃ¡c tÃ i khoáº£n
- âœ… **Auto-reconnection** khi máº¥t káº¿t ná»‘i
- âœ… **Health check mechanism** Ä‘á»ƒ phÃ¡t hiá»‡n connection issues
- âœ… **Persistent storage** vá»›i Docker volumes (khÃ´ng máº¥t data khi restart)
- âœ… API RESTful Ä‘á»ƒ tÃ­ch há»£p vá»›i cÃ¡c há»‡ thá»‘ng khÃ¡c (N8N-friendly)
- âœ… Nháº­n tin nháº¯n vÃ  sá»± kiá»‡n tá»« Zalo thÃ´ng qua webhook real-time
- âœ… API Key authentication cho tÃ­ch há»£p bÃªn ngoÃ i

## Cáº£i tiáº¿n má»›i (v2.0)

### ğŸ”„ Auto-Reconnection
- Tá»± Ä‘á»™ng phÃ¡t hiá»‡n vÃ  reconnect khi connection bá»‹ Ä‘Ã³ng
- Exponential backoff Ä‘á»ƒ trÃ¡nh spam reconnect
- Retry logic thÃ´ng minh vá»›i cooldown period
- **Race condition protection** vá»›i relogin lock mechanism

### ğŸ¥ Health Check
- Kiá»ƒm tra connection health má»—i 2 phÃºt
- Docker health check endpoint: `/health`
- Tá»± Ä‘á»™ng trigger reconnection khi phÃ¡t hiá»‡n váº¥n Ä‘á»

### ğŸ’¾ Docker Volumes
- LÆ°u trá»¯ cookies vÃ  session persistent
- Giá»¯ láº¡i cáº¥u hÃ¬nh proxy
- KhÃ´ng máº¥t data khi restart/rebuild container

### ğŸ›¡ï¸ Production-Ready Stability
- **KhÃ´ng cÃ³ memory leaks** - Proper cleanup cho timers, event listeners, temp files
- **Error handling Ä‘áº§y Ä‘á»§** - Táº¥t cáº£ promises vÃ  async operations Ä‘Æ°á»£c handle
- **Resource management** - WebSocket connections vÃ  file operations Ä‘Æ°á»£c cleanup Ä‘Ãºng cÃ¡ch

ğŸ“– **Chi tiáº¿t sá»­ dá»¥ng:** Xem [USAGE.md](USAGE.md)

## CÃ i Ä‘áº·t

### YÃªu cáº§u há»‡ thá»‘ng

- Node.js v20 trá»Ÿ lÃªn
- Docker & Docker Compose (khuyáº¿n nghá»‹)
- npm hoáº·c yarn

### CÃ¡c bÆ°á»›c cÃ i Ä‘áº·t

1. Clone repository:
   ```bash
   git clone https://github.com/yourusername/multizlogin.git
   cd multizlogin
   ```

2. Táº¡o file `.env` tá»« file máº«u:
   ```bash
   cp .env.example .env
   ```

3. Cáº¥u hÃ¬nh cÃ¡c biáº¿n mÃ´i trÆ°á»ng trong file `.env`:
   ```env
   PORT=3000
   SESSION_SECRET=your_secret_key_change_this
   MESSAGE_WEBHOOK_URL=https://your-n8n.com/webhook/message
   GROUP_EVENT_WEBHOOK_URL=https://your-n8n.com/webhook/group-events
   REACTION_WEBHOOK_URL=https://your-n8n.com/webhook/reactions
   WEBHOOK_LOGIN_SUCCESS=https://your-n8n.com/webhook/login-success
   ```

4. Khá»Ÿi Ä‘á»™ng vá»›i Docker (Khuyáº¿n nghá»‹):
   ```bash
   docker-compose up -d
   ```
   
   Hoáº·c cháº¡y trá»±c tiáº¿p vá»›i Node.js:
   ```bash
   npm install
   npm start
   ```

5. Kiá»ƒm tra health status:
   ```bash
   curl http://localhost:3000/health
   ```

## Docker Volumes vÃ  Persistent Storage

Há»‡ thá»‘ng sá»­ dá»¥ng Docker volumes Ä‘á»ƒ lÆ°u trá»¯ data persistent:

```yaml
volumes:
  - ./data:/app/data              # Cookies vÃ  proxies
```

### Dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯:
- **Cookies**: `./data/cookies/cred_<ownId>.json` - Session cookies cho auto-login
- **User Accounts & API Keys**: `./data/cookies/users.json` - ThÃ´ng tin Ä‘Äƒng nháº­p vÃ  API keys
- **Proxies**: `./data/proxies.json` - Danh sÃ¡ch proxy vÃ  usage tracking
- **Webhook URLs**: Cáº¥u hÃ¬nh qua environment variables trong `.env`

### âš ï¸ QUAN TRá»ŒNG: Deploy trÃªn Dokploy/Cloud

Khi deploy trÃªn cÃ¡c platform nhÆ° Dokploy, Heroku, Railway, v.v., **Báº®T BUá»˜C pháº£i cáº¥u hÃ¬nh volumes** Ä‘á»ƒ trÃ¡nh máº¥t dá»¯ liá»‡u khi redeploy.

**Giáº£i phÃ¡p:** Sá»­ dá»¥ng file [dokploy-compose.yaml](dokploy-compose.yaml) vá»›i **named volumes**.

ğŸ“– **Chi tiáº¿t:** Xem [USAGE.md](USAGE.md) Ä‘á»ƒ biáº¿t hÆ°á»›ng dáº«n Ä‘áº§y Ä‘á»§.

### Reset container an toÃ n (giá»¯ data):
```bash
docker-compose restart              # Restart nhanh
# hoáº·c
docker-compose down && docker-compose up -d  # Restart Ä‘áº§y Ä‘á»§
```

3. Khá»Ÿi Ä‘á»™ng vá»›i Docker:
   ```
   docker-compose up -d
   ```

### Xuáº¥t báº£n Docker Image

Build vÃ  xuáº¥t báº£n image:
```bash
docker-compose build
docker tag multizlogin_zalo-server:latest yourusername/zalo-server:latest
docker push yourusername/zalo-server:latest
```

## Sá»­ dá»¥ng

1. Má»Ÿ trÃ¬nh duyá»‡t vÃ  truy cáº­p: `http://localhost:3000`
2. ÄÄƒng nháº­p tÃ i khoáº£n admin (máº·c Ä‘á»‹nh: `admin/admin`)
3. ÄÄƒng nháº­p tÃ i khoáº£n Zalo thÃ´ng qua nÃºt "ÄÄƒng nháº­p Zalo"
4. Quáº£n lÃ½ tÃ i khoáº£n vÃ  thiáº¿t láº­p webhook trong trang "Quáº£n lÃ½ tÃ i khoáº£n"
5. Quáº£n lÃ½ proxy trong trang "Quáº£n lÃ½ Proxy"

## API

### XÃ¡c thá»±c API

API há»— trá»£ 2 phÆ°Æ¡ng thá»©c xÃ¡c thá»±c:

1. **Session-based** (cho UI): ÄÄƒng nháº­p qua `/admin-login`
2. **API Key** (cho tÃ­ch há»£p): Header `X-API-Key: your_api_key`

Äá»ƒ láº¥y API Key: ÄÄƒng nháº­p vÃ o UI > Settings > Generate API Key

### CÃ¡c API chÃ­nh

- `GET /api/accounts` - Danh sÃ¡ch tÃ i khoáº£n Zalo Ä‘Ã£ Ä‘Äƒng nháº­p
- `GET /api/accounts/:ownId` - Chi tiáº¿t tÃ i khoáº£n
- `DELETE /api/accounts/:ownId` - XÃ³a tÃ i khoáº£n
- `POST /api/accounts/sendMessage` - Gá»­i tin nháº¯n (N8N-friendly)
- `POST /api/accounts/sendImage` - Gá»­i hÃ¬nh áº£nh
- `POST /api/accounts/findUser` - TÃ¬m ngÆ°á»i dÃ¹ng
- `POST /api/accounts/getUserInfo` - Láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng
- `POST /api/accounts/createGroup` - Táº¡o nhÃ³m
- `POST /api/accounts/action` - Action handler chung

ğŸ“– **API Documentation:** Truy cáº­p `/api-docs` Ä‘á»ƒ xem Swagger UI

## TÃ­ch há»£p vá»›i n8n

MultiZlogin Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ tÃ­ch há»£p dá»… dÃ ng vá»›i n8n:

1. Táº¡o Webhook Node trong n8n
2. Cáº¥u hÃ¬nh webhook URL trong `.env`:
   - `MESSAGE_WEBHOOK_URL` - Nháº­n tin nháº¯n Ä‘áº¿n
   - `GROUP_EVENT_WEBHOOK_URL` - Sá»± kiá»‡n nhÃ³m
   - `REACTION_WEBHOOK_URL` - Reaction tin nháº¯n
3. Sá»­ dá»¥ng HTTP Request Node Ä‘á»ƒ gá»i API vá»›i header `X-API-Key`

## ÄÃ³ng gÃ³p

Má»i Ä‘Ã³ng gÃ³p Ä‘á»u Ä‘Æ°á»£c hoan nghÃªnh! Vui lÃ²ng má»Ÿ issue hoáº·c pull request Ä‘á»ƒ cáº£i thiá»‡n dá»± Ã¡n.

## Giáº¥y phÃ©p

[MIT](LICENSE)

## TuyÃªn bá»‘ trÃ¡ch nhiá»‡m

Dá»± Ã¡n nÃ y Ä‘Æ°á»£c phÃ¡t triá»ƒn vá»›i má»¥c Ä‘Ã­ch nghiÃªn cá»©u vÃ  há»c táº­p. NgÆ°á»i dÃ¹ng chá»‹u hoÃ n toÃ n trÃ¡ch nhiá»‡m khi sá»­ dá»¥ng dá»± Ã¡n nÃ y pháº£i tuÃ¢n thá»§ cÃ¡c Ä‘iá»u khoáº£n dá»‹ch vá»¥ cá»§a Zalo vÃ  cÃ¡c quy Ä‘á»‹nh phÃ¡p luáº­t hiá»‡n hÃ nh. ChÃºng tÃ´i khÃ´ng chá»‹u trÃ¡ch nhiá»‡m cho báº¥t ká»³ hÃ nh vi vi pháº¡m nÃ o.

## Lá»i cáº£m Æ¡n

ChÃ¢n thÃ nh cáº£m Æ¡n Ä‘á»™i ngÅ© ZCA Ä‘Ã£ phÃ¡t triá»ƒn thÆ° viá»‡n zca-js, giÃºp chÃºng tÃ´i cÃ³ thá»ƒ xÃ¢y dá»±ng dá»± Ã¡n nÃ y.